{"version":3,"file":"Messages-HJTbm-4D.js","sources":["../../../src/app/pages/Messages.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { rwsdk, type RWMessage, type RWThread } from \"@/app/lib/rwdsk\";\r\nimport { useEffect, useMemo, useState } from \"react\";\r\nimport Sidebar from \"../../components/Sidebar\";\r\n\r\nexport default function Messages() {\r\n  const [threads, setThreads] = useState<RWThread[]>([]);\r\n  const [activeId, setActiveId] = useState<string | null>(null);\r\n  const [messages, setMessages] = useState<RWMessage[]>([]);\r\n\r\n  useEffect(() => {\r\n    rwsdk.chat.listThreads().then((t: RWThread[]) => {\r\n      setThreads(t);\r\n      if (!activeId && t.length) setActiveId(t[0].id);\r\n    });\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (!activeId) return;\r\n    const off = rwsdk.chat.subscribe(activeId, setMessages);\r\n    return off;\r\n  }, [activeId]);\r\n\r\n  const activeTitle = useMemo(\r\n    () => threads.find(t => t.id === activeId)?.title ?? \"\",\r\n    [threads, activeId]\r\n  );\r\n\r\n  return (\r\n    <section className=\"min-h-screen bg-gray-100 dark:bg-gray-950\">\r\n      <main className=\"mx-auto flex max-w-[1400px] gap-0 p-4\">\r\n        <Sidebar />\r\n\r\n        <section className=\"w-80 border-r border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900\">\r\n          <header className=\"border-b border-gray-200 dark:border-gray-700 px-4 py-3\">\r\n            <h2 className=\"text-sm font-medium text-gray-600 dark:text-gray-400\">Samtaler</h2>\r\n          </header>\r\n          <ul className=\"divide-y divide-gray-200 dark:divide-gray-700\">\r\n            {threads.map(t => (\r\n              <li key={t.id}>\r\n                <button\r\n                  onClick={() => setActiveId(t.id)}\r\n                  className={`flex w-full items-center gap-3 px-4 py-3 text-left\r\n                    ${t.id === activeId ? \"bg-blue-50 dark:bg-blue-950\" : \"hover:bg-gray-50 dark:hover:bg-gray-800\"}`}\r\n                  aria-current={t.id === activeId ? \"true\" : \"false\"}\r\n                >\r\n                  <span className=\"inline-flex h-8 w-8 rounded-full bg-gray-200 dark:bg-gray-700\" aria-hidden />\r\n                  <span className=\"min-w-0\">\r\n                    <strong className=\"block truncate text-sm text-gray-900 dark:text-white\">{t.title}</strong>\r\n                    <span className=\"block truncate text-xs text-gray-500 dark:text-gray-400\">{t.lastMessage ?? \"\\u00A0\"}</span>\r\n                  </span>\r\n                </button>\r\n              </li>\r\n            ))}\r\n          </ul>\r\n        </section>\r\n\r\n        <section className=\"flex min-h-[80vh] flex-1 flex-col bg-white dark:bg-gray-900\">\r\n          <header className=\"border-b border-gray-200 dark:border-gray-700 px-6 py-4\">\r\n            <h2 className=\"text-base font-semibold text-gray-900 dark:text-white\">{activeTitle}</h2>\r\n          </header>\r\n\r\n          <section className=\"flex-1 space-y-3 overflow-y-auto px-6 py-4\">\r\n            {messages.map(m => (\r\n              <MessageBubble key={m.id} message={m} selfId=\"u-anne\" />\r\n            ))}\r\n          </section>\r\n\r\n          <footer className=\"border-t border-gray-200 dark:border-gray-700 px-6 py-4\">\r\n            <MessageInput\r\n              disabled={!activeId}\r\n              onSend={async (text) => {\r\n                if (!activeId || !text.trim()) return;\r\n                await rwsdk.chat.send(activeId, text.trim());\r\n              }}\r\n            />\r\n          </footer>\r\n        </section>\r\n      </main>\r\n    </section>\r\n  );\r\n}\r\n\r\nfunction MessageBubble({ message, selfId }: { message: RWMessage; selfId: string }) {\r\n  const mine = message.authorId === selfId;\r\n  return (\r\n    <article className={`flex ${mine ? \"justify-end\" : \"justify-start\"}`}>\r\n      <section className={`max-w-[70%] rounded-2xl px-4 py-2 text-sm leading-relaxed\r\n        ${mine ? \"bg-brand-blue text-white\" : \"bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200\"}`}>\r\n        <p>{message.text}</p>\r\n        <time className={`mt-1 block text-[11px] opacity-75 ${mine ? \"text-white\" : \"text-gray-600 dark:text-gray-400\"}`}>\r\n          {new Date(message.createdAt).toLocaleTimeString([], { hour: \"2-digit\", minute: \"2-digit\" })}\r\n        </time>\r\n      </section>\r\n    </article>\r\n  );\r\n}\r\n\r\nfunction MessageInput({ onSend, disabled }: { onSend: (text: string) => void | Promise<void>; disabled?: boolean }) {\r\n  const [text, setText] = useState(\"\");\r\n  async function submit(e: React.FormEvent) {\r\n    e.preventDefault();\r\n    if (!text.trim()) return;\r\n    await onSend(text);\r\n    setText(\"\");\r\n  }\r\n  return (\r\n    <form onSubmit={submit} className=\"flex items-center gap-3\">\r\n      <label className=\"sr-only\" htmlFor=\"message\">Skriv en melding</label>\r\n      <textarea\r\n        id=\"message\"\r\n        className=\"min-h-10 w-full resize-none rounded-xl border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-800 text-gray-900 dark:text-white px-4 py-2 outline-none focus:border-brand-blue dark:focus:border-blue-400 focus:bg-white dark:focus:bg-gray-700 placeholder:text-gray-400 dark:placeholder:text-gray-500\"\r\n        placeholder=\"Skriv en melding...\"\r\n        value={text}\r\n        onChange={(e) => setText(e.target.value)}\r\n        disabled={disabled}\r\n      />\r\n      <button\r\n        type=\"submit\"\r\n        disabled={disabled}\r\n        className=\"rounded-xl bg-brand-blue hover:bg-blue-600 dark:bg-blue-600 dark:hover:bg-blue-500 px-4 py-2 text-sm font-semibold text-white disabled:opacity-50\"\r\n      >\r\n        Send\r\n      </button>\r\n    </form>\r\n  );\r\n}\r\n"],"names":["Messages","$","_c","t0","Symbol","for","threads","setThreads","useState","activeId","setActiveId","t1","messages","setMessages","t2","rwsdk","chat","listThreads","then","t","length","id","t3","useEffect","t4","t5","subscribe","t6","find","t_0","title","activeTitle","t7","Sidebar","t8","t9","t10","t_1","jsx","jsxs","lastMessage","map","t11","t12","_temp","t13","t14","t15","text","trim","send","t16","MessageInput","t17","t18","m","MessageBubble","message","selfId","mine","authorId","createdAt","Date","toLocaleTimeString","hour","minute","onSend","disabled","setText","e","preventDefault","submit","e_0","target","value"],"mappings":"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"}